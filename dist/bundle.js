!function(o,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ConvivialProfiler",[],e):"object"==typeof exports?exports.ConvivialProfiler=e():o.ConvivialProfiler=e()}(self,(function(){return(()=>{var o={485:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.bestpick=function(i,r,l,n){"localstorage"===r.storage.localstorage&&n[0]&&e.setItem(r.key,n[0]),"cookie"===r.storage.cookie&&n[0]&&o.convivialProfiler._setCookie(r.key,n[0])}}(window,localStorage)},194:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.copy=function(i,r,l,n){"localstorage"===r.storage.localstorage&&e.setItem(r.key,n[0]),"cookie"===r.storage.cookie&&o.convivialProfiler._setCookie(r.key,n[0])}}(window,localStorage)},629:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.datalayer_event=function(e,i,r,l){r.forEach((function(e){o.dataLayer=o.dataLayer||[],o.dataLayer.push({event:"convivialProfiler.event",category:i.category,action:i.action,label:e,value:i.normalize?1/r.length:1})}))}}(window)},88:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.formfiller=function(i,r,l,n){var t="form"+r.form_selector,a=document.querySelector(t);null!==a&&r.fields_selector.forEach((function(i){var l=i.split("|")[0],n=i.split("|")[1];null!==a.querySelector('input[name="'+l+'"]')&&null!==n&&("localstorage"===r.storage.localstorage&&(a.querySelector('input[name="'+l+'"]').value=e.getItem(n)),"cookie"===r.storage.cookie&&(a.querySelector('input[name="'+l+'"]').value=o.convivialProfiler._getCookie(n)))}))}}(window,localStorage)},452:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.officehours=function(i,r,l,n){var t=new Date,a=r.daylight_saving_offset;t.getTime()>=Date.parse(r.normal_start)&&t.getTime()<=Date.parse(r.normal_end)&&(a=r.normal_offset);var c=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds()).getTime()+36e5*a,f=new Date(c),v=0;f.getHours()>=parseInt(r.office_start)&&f.getHours()<=parseInt(r.office_close)&&(v=1),"localstorage"===r.storage.localstorage&&e.setItem("office_open",v),"cookie"===r.storage.cookie&&o.convivialProfiler._setCookie("office_open",v)}}(window,localStorage)},499:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.range=function(i,r,l,n){r.ranges.forEach((function(i){n[0]>=i.min&&n[0]<i.max&&("localstorage"===r.storage.localstorage&&e.setItem(r.key,i.key),"cookie"===r.storage.cookie&&o.convivialProfiler._setCookie(r.key,i.key))}))}}(window,localStorage)},348:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.remove=function(i,r,l,n){n=n.filter((function(o){return null!=o&&""!=o})),Array.isArray(n)&&r.static_values&&void 0!==r.static_values&&r.static_values.forEach((function(o){void 0!==o&&n.push(o)})),n.forEach((function(i){"localstorage"===r.storage.localstorage&&e.removeItem(i),"cookie"===r.storage.cookie&&o.convivialProfiler._setCookie(i,"",0)}))}}(window,localStorage)},205:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.season=function(i,r,l,n){var t=["winter","winter","spring","spring","spring","summer","summer","summer","autumn","autumn","autumn","winter"],a=n[0]<0?6:0,c=((new Date).getMonth()+a)%12;"localstorage"===r.storage.localstorage&&e.setItem(r.key,t[c]),"cookie"===r.storage.cookie&&o.convivialProfiler._setCookie(r.key,t[c])}}(window,localStorage)},433:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.set=function(i,r,l,n){n.forEach((function(i){"localstorage"===r.storage.localstorage&&e.setItem(i,"1"),"cookie"===r.storage.cookie&&o.convivialProfiler._setCookie(i,"1")}))}}(window,localStorage)},706:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.threshold=function(o,i,r,l){if(l[0]>=i.threshold_number&&("localstorage"===i.storage.localstorage&&e.setItem(i.storage_key,i.storage_value),"cookie"===i.storage.cookie)){var n=new Date(Date.now()+864e5).toUTCString();document.cookie=i.storage_key+"="+encodeURIComponent(i.storage_value)+";path=/;expires="+n}}}(window,localStorage)},414:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.top=function(i,r,l,n){var t=null,a=null;n.forEach((function(o){for(var e in o)(o.hasOwnProperty(e)&&null===a||o[e]>a)&&(t=e,a=o[e])})),"localstorage"===r.storage.localstorage&&e.setItem(r.key,t),"cookie"===r.storage.cookie&&o.convivialProfiler._setCookie(r.key,t)}}(window,localStorage)},231:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerDestination=o.convivialProfiler.profilerDestination||{},o.convivialProfiler.profilerDestination.unset=function(i,r,l,n){n.forEach((function(i){"localstorage"===r.storage.localstorage&&e.setItem(i,"0"),"cookie"===r.storage.cookie&&o.convivialProfiler._setCookie(i,"0")}))}}(window,localStorage)},898:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.accumulation=function(e,i,r){r.forEach((function(e){o.convivialProfiler._increaseValue("accumulators",i.key,e)}))}}(window)},23:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.dimension=function(e,i,r){r.forEach((function(e){i.normalize?o.convivialProfiler._increaseSubValue("dimensions",i.key,e,1/r.length):o.convivialProfiler._increaseSubValue("dimensions",i.key,e)}))}}(window)},633:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.extreme_geoip=function(e,i,r){r.forEach((function(e){o.convivialProfiler._setValue("fetchers",i.key,{value:e,expire:o.convivialProfiler._getTime()+i.ttl})}))}}(window)},657:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.language_full=function(e,i,r){var l=o.convivialProfiler._getTime()+i.ttl;null!==i.ttl&&i.ttl>0&&(l=o.convivialProfiler._getTime()-1),r.forEach((function(e){o.convivialProfiler._setValue("store",i.key,{value:e.toLowerCase(),expire:l})}))}}(window)},731:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.language_simple=function(e,i,r){var l=o.convivialProfiler._getTime()+i.ttl;null!==i.ttl&&i.ttl>0&&(l=o.convivialProfiler._getTime()-1),r.forEach((function(e){o.convivialProfiler._setValue("store",i.key,{value:e.split("-")[0].toLowerCase(),expire:l})}))}}(window)},780:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.map=function(e,i,r){if(r&&r.length>0&&r[0]&&i.mappings&&i.mappings.length>0){var l=i.mappings.filter((function(o){return o.includes(r[0]+"|")}));l&&l.length>0&&l[0]?o.convivialProfiler._setValue("store",i.key,{value:l[0].replace(r[0]+"|",""),expire:o.convivialProfiler._getTime()}):o.convivialProfiler._setValue("store",i.key,{value:i.fallback_value,expire:o.convivialProfiler._getTime()})}else o.convivialProfiler._setValue("store",i.key,{value:i.default_value,expire:o.convivialProfiler._getTime()})}}(window)},744:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.pageview=function(e,i,r){!0===i.log&&o.convivialProfiler._logValue(i.key,[o.location.href,o.convivialProfiler._getTime()]),!0===i.track&&o.convivialProfiler._increaseValue("counters",i.key)}}(window)},776:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.searchquery=function(e,i,r){if(o.location.pathname.includes(i.search_path)&&o.location.search.substring(1).length>0){var l=[];o.location.search.substring(1).split("&").forEach((function(o){l.push(o.split("=")[0])})),l.includes(i.query_param)&&!l.includes(i.exclude_param)&&((o.convivialProfiler._getValue("log."+i.key)||[]).includes(o.location.href)||(!0===i.log&&o.convivialProfiler._logValue(i.key,o.location.href,i.size),!0===i.track&&o.convivialProfiler._increaseValue("counters",i.key)))}}}(window)},705:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerProcessor=o.convivialProfiler.profilerProcessor||{},o.convivialProfiler.profilerProcessor.store=function(e,i,r){var l=o.convivialProfiler._getTime()+i.ttl;null!==i.ttl&&i.ttl<1&&(l=o.convivialProfiler._getTime()-1),r.forEach((function(e){o.convivialProfiler._setValue("store",i.key,{value:e,expire:l})}))}}(window)},301:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerSource=o.convivialProfiler.profilerSource||{},o.convivialProfiler.profilerSource.acceptlang=function(o,e,i){null!==navigator.language&&navigator.language.includes("-")?i.push(navigator.language):i.push("en-AU")}}(window,document)},802:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerSource=o.convivialProfiler.profilerSource||{},o.convivialProfiler.profilerSource.cookie=function(e,i,r){var l=o.convivialProfiler._getCookie(i.key);null!==l&&r.push(l)}}(window)},793:()=>{!function(o,e,i){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerSource=o.convivialProfiler.profilerSource||{},o.convivialProfiler.profilerSource.get=function(r,l,n){var t=new e;t.onload=function(){try{n.push(JSON.parse(t.response)),o.convivialProfiler._processValues(r,n)}catch(o){t.onerror()}},t.onerror=function(){i.debug('Unable to fetch values of "'+l.url+'".')},t.open("GET",l.url),t.send()}}(window,XMLHttpRequest,console)},632:()=>{!function(o,e){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerSource=o.convivialProfiler.profilerSource||{},o.convivialProfiler.profilerSource.httpuseragent=function(o,e,i){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?i.push("mobile"):i.push("desktop")}}(window,document)},136:()=>{function o(o,e){(null==e||e>o.length)&&(e=o.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=o[i];return r}!function(e,i){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.profilerSource=e.convivialProfiler.profilerSource||{},e.convivialProfiler.profilerSource.meta=function(e,r,l){var n,t=function(e,i){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,i){if(e){if("string"==typeof e)return o(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,i):void 0}}(e))||i&&e&&"number"==typeof e.length){r&&(e=r);var l=0,n=function(){};return{s:n,n:function(){return l>=e.length?{done:!0}:{done:!1,value:e[l++]}},e:function(o){throw o},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var t,a=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var o=r.next();return a=o.done,o},e:function(o){c=!0,t=o},f:function(){try{a||null==r.return||r.return()}finally{if(c)throw t}}}}(i.querySelectorAll('meta[name="'+r.key+'"]'));try{for(t.s();!(n=t.n()).done;){var a=n.value;l.push(a.getAttribute("content"))}}catch(o){t.e(o)}finally{t.f()}}}(window,document)},131:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerSource=o.convivialProfiler.profilerSource||{},o.convivialProfiler.profilerSource.query=function(e,i,r){o.location.search.substring(1).split("&").forEach((function(o){var e=o.split("=");if(e[0]===i.key||e[0]===i.key+"[]"){var l=decodeURIComponent(e[1].replace(/\+/g," "));r.push(void 0===e[1]||l)}}))}}(window)},599:()=>{!function(o){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.profilerSource=o.convivialProfiler.profilerSource||{},o.convivialProfiler.profilerSource.time=function(o,e,i){"hour"===e.key?i.push((new Date).getHours()):"minute"===e.key?i.push((new Date).getMinutes()):"second"===e.key&&i.push((new Date).getSeconds())}}(window)}},e={};function i(r){var l=e[r];if(void 0!==l)return l.exports;var n=e[r]={exports:{}};return o[r](n,n.exports,i),n.exports}i.n=o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return i.d(e,{a:e}),e},i.d=(o,e)=>{for(var r in e)i.o(e,r)&&!i.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})},i.o=(o,e)=>Object.prototype.hasOwnProperty.call(o,e),i.r=o=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})};var r={};return(()=>{"use strict";function o(o,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(o,r.key,r)}}i.r(r),i.d(r,{default:()=>e}),i(898),i(23),i(633),i(731),i(657),i(780),i(744),i(776),i(705),i(485),i(194),i(629),i(88),i(452),i(499),i(348),i(205),i(433),i(706),i(414),i(231),i(301),i(802),i(793),i(136),i(131),i(599),i(632);const e=function(){function e(o,i,r,l){!function(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.version=1,this.config=o,this.siteId=i,this.licenseKey=r,this.clientId=l||this.getClientId(),this.storage=this._loadStorage(),window.convivialProfiler=window.convivialProfiler||{},this.profilerSource=window.convivialProfiler.profilerSource||{},this.profilerProcessor=window.convivialProfiler.profilerProcessor||{},this.profilerDestination=window.convivialProfiler.profilerDestination||{}}var i,r;return i=e,(r=[{key:"getClientId",value:function(){var o=this._getCookie("ConvivialProfilerClientId");if(null===o){var e=new Uint8Array(10);(window.crypto||window.msCrypto).getRandomValues(e),o="";for(var i=0;i<e.length;i++)o+=("0"+e[i].toString(16)).substr(-2);this._setCookie("ConvivialProfilerClientId",o,365)}return o}},{key:"track",value:function(o,e){this._increaseValue("counters",o),this._logValue(o,[e,this._getTime()])}},{key:"collect",value:function(){var o=this,e=this._getTime();if(Object.keys(this.config.profilers).forEach((function(i){var r=o.config.profilers[i];if(r.deferred){var l=o._getValue("fetchers."+i);if(void 0!==l&&l.expire>e)return}var n=[];r.sources.forEach((function(e){void 0!==o.profilerSource[e.type]?o.profilerSource[e.type](r,e,n):console.debug('Invalid profiler source type "'+e.type+'".')})),o._processValues(r,n),o._destinationValues(r,n)})),void 0!==this._getValue("store")){for(var i in this.storage.store)this.storage.store.hasOwnProperty(i)&&this.storage.store[i].expire<e&&delete this.storage.store[i];this._saveStorage()}}},{key:"_processValues",value:function(o,e){var i=this;o.processors.forEach((function(r){void 0!==i.profilerProcessor[r.type]?i.profilerProcessor[r.type](o,r,e):console.debug('Invalid profiler processor type "'+r.type+'".')}))}},{key:"_destinationValues",value:function(o,e){var i=this;o.destinations.forEach((function(r){if(void 0!==i.profilerDestination[r.type]){var l=[];r.paths.forEach((function(o){if(r.global_storage&&void 0!==r.global_storage)var e=localStorage.getItem(o);else e=i._getValue(o);void 0!==e&&l.push(e)})),l=l.filter((function(o){return null!=o&&""!=o})),Array.isArray(l)&&0===l.length&&r.default_value&&void 0!==r.default_value&&l.push(r.default_value),l.length?i.profilerDestination[r.type](o,r,e,l):r.remove_empty&&!l.length&&localStorage.removeItem(r.key)}else console.debug('Invalid profiler destination type "'+r.type+'".')}))}},{key:"_loadStorage",value:function(){var o=JSON.parse(localStorage.getItem("convivial_profiler"))||{};return!0===this._getConfig("client_cleanup")&&o._clientId!==this.clientId?(localStorage.removeItem("convivial_profiler"),{}):o[this.siteId]||{}}},{key:"_saveStorage",value:function(){var o=JSON.parse(localStorage.getItem("convivial_profiler"))||{};o._clientId=this.clientId,o._version=this.version,o._licenseKey=this.licenseKey,o[this.siteId]=this.storage,localStorage.setItem("convivial_profiler",JSON.stringify(o))}},{key:"_getValue",value:function(o,e){return e=e||this.storage,(Array.isArray(o)?o:o.split(".")).reduce((function(o,e){return o&&o[e]}),e)}},{key:"_getConfig",value:function(o){return this._getValue(o,this.config)}},{key:"_setValue",value:function(o,e,i){this.storage[o]=this.storage[o]||{},this.storage[o][e]=i,this._saveStorage()}},{key:"_increaseValue",value:function(o,e,i){this.storage[o]=this.storage[o]||{},this.storage[o][e]=this.storage[o][e]||0,this.storage[o][e]+=parseFloat(i)||1,this._saveStorage()}},{key:"_increaseSubValue",value:function(o,e,i,r){this.storage[o]=this.storage[o]||{},this.storage[o][e]=this.storage[o][e]||{},this.storage[o][e][i]=this.storage[o][e][i]||0,this.storage[o][e][i]+=parseFloat(r)||1,this._saveStorage()}},{key:"_logValue",value:function(o,e,i){this.storage.log=this.storage.log||{},this.storage.log[o]=this.storage.log[o]||[],void 0!==i&&this.storage.log[o].length==i&&this.storage.log[o].shift(),this.storage.log[o].push(e),this._saveStorage()}},{key:"_getTime",value:function(){return Math.round((new Date).getTime()/1e3)}},{key:"_getCookie",value:function(o){var e=document.cookie.match("(^|;) ?"+o+"=([^;]*)(;|$)");return e?decodeURIComponent(e[2]):null}},{key:"_setCookie",value:function(o,e,i){var r=new Date(Date.now()+864e5*i).toUTCString();document.cookie=o+"="+encodeURIComponent(e)+";path=/;expires="+r}}])&&o(i.prototype,r),Object.defineProperty(i,"prototype",{writable:!1}),e}()})(),r})()}));