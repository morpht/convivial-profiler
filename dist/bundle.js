!function(e,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof define&&define.amd?define("ConvivialProfiler",[],o):"object"==typeof exports?exports.ConvivialProfiler=o():e.ConvivialProfiler=o()}(self,(function(){return(()=>{var e={992:()=>{!function(e){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorHandler=e.convivialProfiler.processorHandler||{},e.convivialProfiler.processorHandler.accumulation=function(o,r,i){i.forEach((function(o){e.convivialProfiler._increaseValue("accumulators",r.key,o)}))}}(window)},523:()=>{!function(e){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorHandler=e.convivialProfiler.processorHandler||{},e.convivialProfiler.processorHandler.datalayer_event=function(o,r,i){i.forEach((function(o){e.dataLayer=e.dataLayer||[],e.dataLayer.push({event:"convivialProfiler.event",category:r.category,action:r.action,label:o,value:r.normalize?1/i.length:1})}))}}(window)},868:()=>{!function(e){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorHandler=e.convivialProfiler.processorHandler||{},e.convivialProfiler.processorHandler.dimension=function(o,r,i){i.forEach((function(o){r.normalize?e.convivialProfiler._increaseSubValue("dimensions",r.key,o,1/i.length):e.convivialProfiler._increaseSubValue("dimensions",r.key,o)}))}}(window)},215:()=>{!function(e){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorHandler=e.convivialProfiler.processorHandler||{},e.convivialProfiler.processorHandler.extreme_geoip=function(o,r,i){i.forEach((function(o){e.convivialProfiler._setValue("fetchers",r.key,{value:o,expire:e.convivialProfiler._getTime()+r.ttl})}))}}(window)},480:()=>{!function(e){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorHandler=e.convivialProfiler.processorHandler||{},e.convivialProfiler.processorHandler.store=function(o,r,i){var n=e.convivialProfiler._getTime()+r.ttl;null!==r.ttl&&r.ttl>0&&(n=e.convivialProfiler._getTime()-1),i.forEach((function(o){e.convivialProfiler._setValue("store",r.key,{value:o,expire:n})}))}}(window)},889:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorPublisher=e.convivialProfiler.processorPublisher||{},e.convivialProfiler.processorPublisher.copy=function(r,i){"localstorage"===r.storage.localstorage&&o.setItem(r.key,i[0]),"cookie"===r.storage.cookie&&e.convivialProfiler._setCookie(r.key,i[0])}}(window,localStorage)},746:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorPublisher=e.convivialProfiler.processorPublisher||{},e.convivialProfiler.processorPublisher.range=function(r,i){r.ranges.forEach((function(n){i[0]>=n.min&&i[0]<n.max&&("localstorage"===r.storage.localstorage&&o.setItem(r.key,n.key),"cookie"===r.storage.cookie&&e.convivialProfiler._setCookie(r.key,n.key))}))}}(window,localStorage)},380:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorPublisher=e.convivialProfiler.processorPublisher||{},e.convivialProfiler.processorPublisher.remove=function(r,i){i.forEach((function(i){o.removeItem(i),"localstorage"===r.storage.localstorage&&o.removeItem(i),"cookie"===r.storage.cookie&&e.convivialProfiler._setCookie(i,"",0)}))}}(window,localStorage)},51:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorPublisher=e.convivialProfiler.processorPublisher||{},e.convivialProfiler.processorPublisher.season=function(r,i){var n=["winter","winter","spring","spring","spring","summer","summer","summer","autumn","autumn","autumn","winter"],t=i[0]<0?6:0,l=((new Date).getMonth()+t)%12;"localstorage"===r.storage.localstorage&&o.setItem(r.key,n[l]),"cookie"===r.storage.cookie&&e.convivialProfiler._setCookie(r.key,n[l])}}(window,localStorage)},846:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorPublisher=e.convivialProfiler.processorPublisher||{},e.convivialProfiler.processorPublisher.set=function(r,i){i.forEach((function(i){"localstorage"===r.storage.localstorage&&o.setItem(i,"1"),"cookie"===r.storage.cookie&&e.convivialProfiler._setCookie(i,"1")}))}}(window,localStorage)},733:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorPublisher=e.convivialProfiler.processorPublisher||{},e.convivialProfiler.processorPublisher.threshold=function(e,r){if(r[0]>e.threshold_number&&("localstorage"===e.storage.localstorage&&o.setItem(e.storage_key,e.storage_value),"cookie"===e.storage.cookie)){var i=new Date(Date.now()+864e5).toUTCString();document.cookie=e.storage_key+"="+encodeURIComponent(e.storage_value)+";path=/;expires="+i}}}(window,localStorage)},819:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorPublisher=e.convivialProfiler.processorPublisher||{},e.convivialProfiler.processorPublisher.top=function(r,i){var n=null,t=null;i.forEach((function(e){for(var o in e)(e.hasOwnProperty(o)&&null===t||e[o]>t)&&(n=o,t=e[o])})),"localstorage"===r.storage.localstorage&&o.setItem(r.key,n),"cookie"===r.storage.cookie&&e.convivialProfiler._setCookie(r.key,n)}}(window,localStorage)},658:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorPublisher=e.convivialProfiler.processorPublisher||{},e.convivialProfiler.processorPublisher.unset=function(r,i){i.forEach((function(i){"localstorage"===r.storage.localstorage&&o.setItem(i,"0"),"cookie"===r.storage.cookie&&e.convivialProfiler._setCookie(i,"0")}))}}(window,localStorage)},410:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorSource=e.convivialProfiler.processorSource||{},e.convivialProfiler.processorSource.acceptlangfull=function(e,o,r){null!==navigator.language&&navigator.language.includes("-")?r.push(navigator.language):r.push("en-AU")}}(window,document)},69:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorSource=e.convivialProfiler.processorSource||{},e.convivialProfiler.processorSource.acceptlangsimple=function(e,o,r){null!==navigator.language&&navigator.language.includes("-")?r.push(navigator.language.split("-")[0]):r.push("en")}}(window,document)},429:()=>{!function(e){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorSource=e.convivialProfiler.processorSource||{},e.convivialProfiler.processorSource.cookie=function(o,r,i){var n=e.convivialProfiler._getCookie(r.key);null!==n&&i.push(n)}}(window)},393:()=>{!function(e,o,r){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorSource=e.convivialProfiler.processorSource||{},e.convivialProfiler.processorSource.get=function(i,n,t){var l=new o;l.onload=function(){try{t.push(JSON.parse(l.response)),e.convivialProfiler._processValues(i,t)}catch(e){l.onerror()}},l.onerror=function(){r.debug('Unable to fetch values of "'+n.url+'".')},l.open("GET",n.url),l.send()}}(window,XMLHttpRequest,console)},287:()=>{function e(e,o){(null==o||o>e.length)&&(o=e.length);for(var r=0,i=new Array(o);r<o;r++)i[r]=e[r];return i}!function(o,r){o.convivialProfiler=o.convivialProfiler||{},o.convivialProfiler.processorSource=o.convivialProfiler.processorSource||{},o.convivialProfiler.processorSource.meta=function(o,i,n){var t,l=function(o,r){var i="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!i){if(Array.isArray(o)||(i=function(o,r){if(o){if("string"==typeof o)return e(o,r);var i=Object.prototype.toString.call(o).slice(8,-1);return"Object"===i&&o.constructor&&(i=o.constructor.name),"Map"===i||"Set"===i?Array.from(o):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(o,r):void 0}}(o))||r&&o&&"number"==typeof o.length){i&&(o=i);var n=0,t=function(){};return{s:t,n:function(){return n>=o.length?{done:!0}:{done:!1,value:o[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,s=!1;return{s:function(){i=i.call(o)},n:function(){var e=i.next();return a=e.done,e},e:function(e){s=!0,l=e},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw l}}}}(r.querySelectorAll('meta[name="'+i.key+'"]'));try{for(l.s();!(t=l.n()).done;){var a=t.value;n.push(a.getAttribute("content"))}}catch(e){l.e(e)}finally{l.f()}}}(window,document)},726:()=>{!function(e){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorSource=e.convivialProfiler.processorSource||{},e.convivialProfiler.processorSource.query=function(o,r,i){e.location.search.substring(1).split("&").forEach((function(e){var o=e.split("=");if(o[0]===r.key||o[0]===r.key+"[]"){var n=decodeURIComponent(o[1].replace(/\+/g," "));i.push(void 0===o[1]||n)}}))}}(window)},957:()=>{!function(e){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorSource=e.convivialProfiler.processorSource||{},e.convivialProfiler.processorSource.time=function(e,o,r){"hour"===o.key?r.push((new Date).getHours()):"minute"===o.key?r.push((new Date).getMinutes()):"second"===o.key&&r.push((new Date).getSeconds())}}(window)},222:()=>{!function(e,o){e.convivialProfiler=e.convivialProfiler||{},e.convivialProfiler.processorSource=e.convivialProfiler.processorSource||{},e.convivialProfiler.processorSource.useragent=function(e,o,r){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?r.push("mobile"):r.push("desktop")}}(window,document)}},o={};function r(i){var n=o[i];if(void 0!==n)return n.exports;var t=o[i]={exports:{}};return e[i](t,t.exports,r),t.exports}r.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return r.d(o,{a:o}),o},r.d=(e,o)=>{for(var i in o)r.o(o,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:o[i]})},r.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";function e(e,o){for(var r=0;r<o.length;r++){var i=o[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}r.r(i),r.d(i,{default:()=>o}),r(992),r(523),r(868),r(215),r(480),r(889),r(746),r(380),r(51),r(846),r(733),r(819),r(658),r(410),r(69),r(429),r(393),r(287),r(726),r(957),r(222);const o=function(){function o(e,r,i,n){!function(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}(this,o),this.version=1,this.config=e,this.siteId=r,this.licenseKey=i,this.clientId=n||this.getClientId(),this.storage=this._loadStorage(),window.convivialProfiler=window.convivialProfiler||{},this.processorSource=window.convivialProfiler.processorSource||{},this.processorHandler=window.convivialProfiler.processorHandler||{},this.processorPublisher=window.convivialProfiler.processorPublisher||{},void 0!==this._getConfig("trackers.pageview")&&this.track("pageview",window.location.href)}var r,i;return r=o,(i=[{key:"getClientId",value:function(){var e=this._getCookie("ConvivialProfilerClientId");if(null===e){if(null!==(e=this._getCookie("BasilClientId")))return this._setCookie("ConvivialProfilerClientId",e,365),this._setCookie("BasilClientId","",0),e;var o=new Uint8Array(10);(window.crypto||window.msCrypto).getRandomValues(o),e="";for(var r=0;r<o.length;r++)e+=("0"+o[r].toString(16)).substr(-2);this._setCookie("ConvivialProfilerClientId",e,365)}return e}},{key:"track",value:function(e,o){this._increaseValue("counters",e),this._logValue(e,o);var r=this._getConfig("trackers."+e+".publishers");void 0!==r&&this._publish(r)}},{key:"collect",value:function(){var e=this,o=this._getTime();if(Object.keys(this.config.processors).forEach((function(r){var i=e.config.processors[r];if(i.deferred){var n=e._getValue("fetchers."+r);if(void 0!==n&&n.expire>o)return}var t=[];i.sources.forEach((function(o){void 0!==e.processorSource[o.type]?e.processorSource[o.type](i,o,t):console.debug('Invalid processor source type "'+o.type+'".')})),e._processValues(i,t)})),void 0!==this._getValue("store")){for(var r in this.storage.store)this.storage.store.hasOwnProperty(r)&&this.storage.store[r].expire<o&&delete this.storage.store[r];this._saveStorage()}}},{key:"render",value:function(){var e=this._getConfig("render");if(void 0!==e){var o=document.querySelector(e.selector);o&&(o.innerHTML=e.privacy)}}},{key:"_processValues",value:function(e,o){var r=this;e.handlers.forEach((function(i){void 0!==r.processorHandler[i.type]?r.processorHandler[i.type](e,i,o):console.debug('Invalid processor handler type "'+i.type+'".')})),e.publishers&&this._publish(e.publishers)}},{key:"_publish",value:function(e){var o=this;e.forEach((function(e){var r=o._getConfig("publishers."+e);if(void 0!==r){var i=[];r.key=e,r.paths.forEach((function(e){var r=o._getValue(e);void 0!==r&&i.push(r)})),i.length?void 0!==o.processorPublisher[r.type]?o.processorPublisher[r.type](r,i):console.debug('Invalid processor publisher type "'+r.type+'".'):r.remove_empty&&localStorage.removeItem(r.key)}}))}},{key:"_loadStorage",value:function(){var e=JSON.parse(localStorage.getItem("convivial_profiler"))||{};if(!Object.keys(e).length){var o=localStorage.getItem("basil");null!==o&&(e=JSON.parse(o)||{},localStorage.setItem("convivial_profiler",o),localStorage.removeItem("basil"))}return Object.keys(e).length>0&&null!==e[this.siteId]&&null!==e[this.siteId].currents&&(e[this.siteId].store=e[this.siteId].currents,delete e[this.siteId].currents,localStorage.setItem("convivial_profiler",JSON.stringify(e))),!0===this._getConfig("prepare.client_cleanup")&&e._clientId!==this.clientId?(localStorage.removeItem("convivial_profiler"),{}):e[this.siteId]||{}}},{key:"_saveStorage",value:function(){var e=JSON.parse(localStorage.getItem("convivial_profiler"))||{};e._clientId=this.clientId,e._version=this.version,e._licenseKey=this.licenseKey,e[this.siteId]=this.storage,localStorage.setItem("convivial_profiler",JSON.stringify(e))}},{key:"_getValue",value:function(e,o){return o=o||this.storage,(Array.isArray(e)?e:e.split(".")).reduce((function(e,o){return e&&e[o]}),o)}},{key:"_getConfig",value:function(e){return this._getValue(e,this.config)}},{key:"_setValue",value:function(e,o,r){this.storage[e]=this.storage[e]||{},this.storage[e][o]=r,this._saveStorage()}},{key:"_increaseValue",value:function(e,o,r){this.storage[e]=this.storage[e]||{},this.storage[e][o]=this.storage[e][o]||0,this.storage[e][o]+=parseFloat(r)||1,this._saveStorage()}},{key:"_increaseSubValue",value:function(e,o,r,i){this.storage[e]=this.storage[e]||{},this.storage[e][o]=this.storage[e][o]||{},this.storage[e][o][r]=this.storage[e][o][r]||0,this.storage[e][o][r]+=parseFloat(i)||1,this._saveStorage()}},{key:"_logValue",value:function(e,o,r){this.storage.log=this.storage.log||{},this.storage.log[e]=this.storage.log[e]||[],this.storage.log[e].push([o,r||this._getTime()]),this._saveStorage()}},{key:"_getTime",value:function(){return Math.round((new Date).getTime()/1e3)}},{key:"_getCookie",value:function(e){var o=document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return o?decodeURIComponent(o[2]):null}},{key:"_setCookie",value:function(e,o,r){var i=new Date(Date.now()+864e5*r).toUTCString();document.cookie=e+"="+encodeURIComponent(o)+";path=/;expires="+i}}])&&e(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),o}()})(),i})()}));